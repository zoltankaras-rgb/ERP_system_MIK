<!DOCTYPE html>
<html lang="sk">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Objednávkový systém - MIK s.r.o.</title>
    <link rel="icon" href="data:;base64,iVBORw0KGgo=">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.1/css/all.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/b2c_style.css') }}">
</head>
<body>

    <div class="container">
        <header>
            <div class="sticky-tools" style="position:sticky; top:0; z-index:900; background:#fff; padding:10px 0; border-bottom:1px solid #e2e8f0; margin-bottom: 20px;">
                <div style="display:flex; flex-direction:column; gap:10px;">
                    
                    <div style="position:relative;">
                        <i class="fas fa-search" style="position:absolute; left:12px; top:50%; transform:translateY(-50%); color:#94a3b8;"></i>
                        <input type="text" id="productSearch" placeholder="Hľadať produkt (napr. klobása, stehno)..." 
                               onkeyup="filterProducts()"
                               style="width:100%; padding:10px 10px 10px 35px; border-radius:20px; border:1px solid #cbd5e1; font-size:1rem;">
                    </div>

                    <div id="category-nav" style="display:flex; overflow-x:auto; gap:8px; padding-bottom:5px; scrollbar-width:none;">
                        </div>
                </div>
            </div>

            <img src="https://www.miksro.sk/wp-content/uploads/2025/09/Dizajn-bez-nazvu-1.png" alt="Logo MIK s.r.o." class="logo">
            <div id="header-auth-links" class="header-auth-links"></div>
        </header>

        <div id="loggedOutView">
            <div id="public-pricelist-container"></div>
            
            <div class="pricelist-info-footer" style="margin-top: 1rem; padding-top: 0.5rem; border-top: 1px solid #e2e8f0; font-size: 0.75rem; color: #64748b; line-height: 1.4;">
                <p style="margin: 0;">
                    Všetky uvedené ceny sú vrátane DPH.<br>
                    Cena je uvedená za 1 kilogram (kg), pri kusovom sortimente za 1 kus (ks).<br>
                    Ide o predaj čerstvého výsekového mäsa a mäsových výrobkov našej výroby. Tovar je dodávaný najneskôr do uplynutia prvej tretiny dátumu spotreby. Dátum spotreby je vždy uvedený na obale výrobku alebo na dodacom liste.
                </p>
            </div>

            <div id="auth-section" class="auth-section">
                <div class="tab-nav">
                    <button class="tab-button active" data-tab="login">Prihlásenie</button>
                    <button class="tab-button" data-tab="register">Nová registrácia</button>
                </div>

                <div id="login-tab" class="tab-content active">
                    <h3>Prihlásenie</h3>
                    <form id="loginForm" autocomplete="on">
                        <div class="form-group">
                            <label for="login-email">E-mail</label>
                            <input type="email" name="email" id="login-email" required autocomplete="username">
                        </div>
                        <div class="form-group">
                            <label for="login-password">Heslo</label>
                            <input type="password" name="password" id="login-password" required autocomplete="current-password">
                        </div>

                        <div class="form-group" style="text-align:right; margin-top:4px;">
                            <a href="#" onclick="openModal('password-reset-modal'); return false;"
                               class="forgot-password-link" style="font-size:0.9rem;">
                                Zabudli ste heslo?
                            </a>
                        </div>

                        <button type="submit" class="button">Prihlásiť sa</button>
                    </form>
                </div>

                <div id="register-tab" class="tab-content">
                    <h3>Registrácia</h3>
                    <form id="registerForm" autocomplete="on">
                        <div class="form-group">
                            <label for="reg-name">Meno a Priezvisko</label>
                            <input type="text" id="reg-name" name="name" required autocomplete="name">
                        </div>
                        <div class="form-group">
                            <label for="reg-email">E-mail</label>
                            <input type="email" id="reg-email" name="email" required autocomplete="email">
                        </div>
                        <div class="form-group">
                            <label for="reg-phone">Telefón</label>
                            <input type="tel" id="reg-phone" name="phone" required autocomplete="tel">
                        </div>
                        <div class="form-group">
                            <label for="reg-address">Fakturačná adresa</label>
                            <input type="text" id="reg-address" name="address" required autocomplete="street-address">
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="same-address-checkbox" checked>
                                Doručovacia adresa je rovnaká ako fakturačná
                            </label>
                        </div>

                        <div id="delivery-address-group" class="form-group hidden">
                            <label for="reg-delivery-address">Adresa doručenia</label>
                            <input type="text" id="reg-delivery-address" name="delivery_address" autocomplete="street-address">
                        </div>

                        <div class="form-group">
                            <label for="reg-password">Heslo (min. 6 znakov)</label>
                            <input type="password" id="reg-password" name="password" required autocomplete="new-password">
                        </div>

                        <div class="form-group">
                            <label for="reg-dob">Dátum narodenia (narodeninový bonus)</label>
                            <input type="date" id="reg-dob" name="dob" autocomplete="bday">
                            <small>
                                Ak vyplníte dátum narodenia, môžeme vám posielať špeciálne
                                <strong>narodeninové odmeny a bonusy</strong>.
                            </small>
                        </div>

                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="reg-terms" name="gdpr_terms" required>
                                Súhlasím s <a href="#" onclick="openModal('terms-modal'); return false;">Obchodnými podmienkami</a>.
                            </label>
                        </div>
                        <div class="form-group">
                            <label class="checkbox-label">
                                <input type="checkbox" id="reg-gdpr" name="gdpr_privacy" required>
                                Beriem na vedomie <a href="#" onclick="openModal('privacy-modal'); return false;">Ochranu osobných údajov</a>.
                            </label>
                        </div>

                        <div class="form-group">
                            <strong>Marketingové súhlasy (dobrovoľné):</strong><br>
                            <label class="checkbox-label"><input type="checkbox" name="marketing_email"> E-mail ponuky</label><br>
                            <label class="checkbox-label"><input type="checkbox" name="marketing_sms"> SMS ponuky</label><br>
                            <label class="checkbox-label"><input type="checkbox" name="marketing_newsletter"> Newsletter</label><br>
                            <label class="checkbox-label">
                                <input type="checkbox" name="birthday_bonus_opt_in" checked>
                                Narodeninový bonus (odporúčame ponechať zapnuté)
                            </label>
                        </div>

                        <input type="text" name="hp_url" style="display:none" tabindex="-1" autocomplete="off">
                        <input type="hidden" name="form_ts" value="">
                        <div class="form-group">
                            <label id="captcha-question">Overujem…</label>
                            <input type="number" name="captcha_answer" inputmode="numeric" required style="max-width: 120px;" autocomplete="off">
                        </div>

                        <button type="submit" class="button">Zaregistrovať sa</button>
                    </form>
                </div>
            </div>

            <div id="public-helper"
                 style="margin-top:2rem;padding:1.25rem 1.5rem;border-radius:0.75rem;background:#f8fafc;border:1px solid #e2e8f0;">
                <h3>Pomocník – ako začať</h3>
                <p>
                    Tento portál slúži na jednoduché objednávanie výrobkov od spoločnosti
                    <strong>MIK s.r.o.</strong>. Pred vytvorením objednávky je potrebné
                    sa zaregistrovať a prihlásiť.
                </p>
                <ul>
                    <li>
                        V záložke <strong>Nová registrácia</strong> vyplníte svoje kontaktné údaje.
                    </li>
                    <li>
                        <strong>Dátum narodenia je dobrovoľný</strong> – ak ho uvediete a povolíte
                        narodeninový bonus, vieme vám pripraviť špeciálne
                        <strong>narodeninové odmeny a prekvapenia</strong>.
                    </li>
                    <li>
                        Po registrácii sa môžete prihlásiť a v záložke
                        <strong>Nová objednávka</strong> vyberať tovar a odoslať objednávku.
                    </li>
                </ul>
                <h4>Vaše údaje a GDPR v skratke</h4>
                <p style="font-size:0.95rem;color:#334155;">
                    Vaše údaje používame <strong>len na vybavenie objednávok, komunikáciu
                    so zákazníkom a vernostný program</strong> (vrátane narodeninových bonusov,
                    ak ich chcete). Nepredávame ich žiadnym tretím stranám a neposkytujeme ich
                    na cudzie marketingové účely. Údaje zostávajú u nás – výnimkou sú len
                    nevyhnutní technickí partneri (napr. hosting, doprava), ktorí musia
                    spĺňať rovnaké požiadavky na ochranu údajov.
                </p>
                <p style="font-size:0.95rem;color:#334155;">
                    V prípade otázok nás môžete kontaktovať na
                    <strong>expedícii: <a href="tel:+421905518114">0905 518 114</a></strong>.
                </p>
            </div>
        </div>

        <div id="loggedInView" class="hidden">
            <h2 class="welcome-message">Vitajte, <span id="customer-name"></span>!</h2>

            <div id="loyalty-info" class="loyalty-info">
                <p>Vaše vernostné body: <span id="customer-points">0</span></p>
                <button id="claim-reward-btn" class="button" style="background-color: #16a34a;" onclick="showRewardsModal()">Uplatniť odmenu</button>
            </div>

            <div id="customer-main-tabs">
                <div class="tab-nav">
                    <button class="tab-button active" data-tab="order-content">Nová objednávka</button>
                    <button class="tab-button" data-tab="history-content">Moje objednávky</button>
                    <button class="tab-button" data-tab="helper-content">Pomocník</button>
                </div>

                <div id="order-content" class="tab-content active">
                    <form id="orderForm">
                        <div id="order-pricelist-container"></div>
                        
                        <div class="pricelist-info-footer" style="margin-top: 1rem; padding-top: 0.5rem; border-top: 1px solid #e2e8f0; font-size: 0.75rem; color: #64748b; line-height: 1.4;">
                            <p style="margin: 0;">
                                Všetky uvedené ceny sú vrátane DPH.<br>
                                Cena je uvedená za 1 kilogram (kg), pri kusovom sortimente za 1 kus (ks).<br>
                                Ide o predaj čerstvého výsekového mäsa a mäsových výrobkov našej výroby. Tovar je dodávaný najneskôr do uplynutia prvej tretiny dátumu spotreby. Dátum spotreby je vždy uvedený na obale výrobku alebo na dodacom liste.
                            </p>
                        </div>

                        <div id="order-summary-section" class="hidden">
                            <h3>Súhrn a doručenie</h3>

                            <div class="form-group">
                                <label for="deliveryDate">Požadovaný dátum vyzdvihnutia:</label>
                                <input type="date" id="deliveryDate" name="deliveryDate" required>
                            </div>

                            <div class="form-group">
                                <label for="orderNote">Poznámka k objednávke:</label>
                                <textarea id="orderNote" name="orderNote" rows="3"></textarea>
                            </div>

                            <div class="total-summary">
                                <div id="total-price">Suma objednávky: <strong>0.00 €</strong></div>
                                <div id="min-order-warning" class="min-order-warning hidden">
                                    Minimálna hodnota objednávky je 20.00 €
                                </div>
                            </div>

                            <button type="submit" class="button">Objednať s povinnosťou platby</button>
                        </div>
                    </form>
                </div>

                <div id="history-content" class="tab-content">
                    <h3>História objednávok</h3>
                    <div id="history-container"></div>
                </div>

                <div id="helper-content" class="tab-content">
                    <h3>Pomocník – ako používať B2C objednávkový systém</h3>
                    <p>
                        Tento portál slúži na pohodlné objednávanie tovaru priamo od nás.
                        Nižšie nájdete návod a odpovede na najčastejšie otázky.
                        V prípade akýchkoľvek nejasností nás kontaktujte na telefónnom čísle
                        <strong>expedície: <a href="tel:+421905518114">0905 518 114</a></strong>.
                    </p>
                    <h4>1. Prihlásenie a registrácia</h4>
                    <ul>
                        <li>Ak už máte konto, použijete formulár <strong>Prihlásenie</strong>.</li>
                        <li>Ak ste tu prvýkrát, vyplníte <strong>Registráciu</strong>, potvrdíte podmienky a GDPR a odošlete formulár.</li>
                    </ul>
                    <h4>7. Kontakt</h4>
                    <ul>
                        <li>telefón na expedíciu: <strong><a href="tel:+421905518114">0905 518 114</a></strong></li>
                        <li>e‑mail: <a href="mailto:info@miksro.sk">info@miksro.sk</a></li>
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div id="rewards-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h4>Vyberte si odmenu</h4>
                <button class="modal-close" onclick="closeModal('rewards-modal')">&times;</button>
            </div>
            <p>Máte <strong id="modal-customer-points">0</strong> bodov.</p>
            <div id="rewards-list-container">Načítavam dostupné odmeny...</div>
        </div>
    </div>

    <div id="password-reset-modal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h4>Obnova hesla</h4>
          <button class="modal-close" onclick="closeModal('password-reset-modal')">&times;</button>
        </div>
        <div class="modal-body">
          <p>
            Zadajte e‑mail, ktorý používate pri prihlásení.
            Ak u nás existuje účet, pošleme vám e‑mail s odkazom na nastavenie nového hesla.
          </p>
          <div class="form-group">
            <label for="password-reset-email">E‑mail</label>
            <input type="email" id="password-reset-email" autocomplete="email">
          </div>
          <button type="button" class="button" onclick="submitPasswordResetRequest()">Odoslať odkaz na obnovu</button>
          <p id="password-reset-message" style="margin-top:0.75rem;font-size:0.9rem;color:#334155;"></p>
        </div>
      </div>
    </div>

    <div id="password-change-modal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h4>Nastavenie nového hesla</h4>
          <button class="modal-close" onclick="closeModal('password-change-modal')">&times;</button>
        </div>
        <div class="modal-body">
          <p>
            Zadajte si nové heslo pre váš účet.
          </p>
          <div class="form-group">
            <label for="new-password">Nové heslo</label>
            <input type="password" id="new-password" autocomplete="new-password">
          </div>
          <div class="form-group">
            <label for="new-password2">Potvrdenie hesla</label>
            <input type="password" id="new-password2" autocomplete="new-password">
          </div>
          <button type="button" class="button" onclick="submitNewPassword()">Uložiť nové heslo</button>
          <p id="password-change-message" style="margin-top:0.75rem;font-size:0.9rem;color:#334155;"></p>
        </div>
      </div>
    </div>

    <div id="item-note-modal" class="modal-overlay">
       <div class="modal-content">
            <div class="modal-header">
                <h4 id="item-note-modal-title"></h4>
                <button class="modal-close" onclick="closeModal('item-note-modal')">&times;</button>
            </div>
            <p>
                Zadali ste objednávku na kusy. Ak máte špecifickú požiadavku, uveďte ju prosím.
            </p>
            <div class="form-group">
                <label for="item-note-input">Poznámka k položke:</label>
                <textarea id="item-note-input" rows="3"></textarea>
            </div>
            <button id="save-item-note-btn" class="button">Potvrdiť</button>
        </div>
    </div>

    <div id="product-info-modal" class="modal-overlay">
        <div class="modal-content">
            <div class="modal-header">
                <h4>Informácie o produkte</h4>
                <button class="modal-close" onclick="closeModal('product-info-modal')">&times;</button>
            </div>
            <div class="modal-body" style="padding:20px;">
                <div id="pim-img-container" style="margin-bottom:15px; text-align:center;"></div>
                <div id="pim-title" style="font-weight:700;font-size:1.2rem;margin-bottom:8px; color:#1e293b;"></div>
                <div id="pim-desc" style="white-space:pre-wrap; color:#333; line-height:1.6; font-size:0.95rem;"></div>
            </div>
        </div>
    </div>

    <div id="terms-modal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h4>Všeobecné obchodné podmienky (B2C)</h4>
          <button class="modal-close" onclick="closeModal('terms-modal')">&times;</button>
        </div>
        <div class="modal-body">
          <p><strong>Prevádzkovateľ e-shopu:</strong> MIK, s.r.o...</p>
          <p>Účinnosť od: 3. 11. 2025</p>
          <p>Úplné znenie VOP nájdete u prevádzkovateľa.</p>
        </div>
      </div>
    </div>

    <div id="privacy-modal" class="modal-overlay">
      <div class="modal-content">
        <div class="modal-header">
          <h4>Ochrana osobných údajov (GDPR)</h4>
          <button class="modal-close" onclick="closeModal('privacy-modal')">&times;</button>
        </div>
        <div class="modal-body">
          <p>Informácie o spracúvaní osobných údajov.</p>
        </div>
      </div>
    </div>

    <div id="cookie-banner" class="cookie-banner hidden">
        <div class="cookie-content">
            <h3>Súkromie a cookies</h3>
            <p>
                Tento web používa súbory cookies. Nevyhnutné cookies sú potrebné pre fungovanie stránky.
                Analytické cookies nám pomáhajú vylepšovať web, potrebujeme na ne váš súhlas.
                <a href="#" onclick="openModal('privacy-modal'); return false;">Viac informácií</a>.
            </p>
        </div>
        <div class="cookie-actions">
            <button id="cookie-reject" class="button" style="background-color: #64748b;">Len nevyhnutné</button>
            <button id="cookie-accept" class="button">Súhlasím so všetkým</button>
        </div>
    </div>

    <div id="mobile-sticky-cart" class="mobile-sticky-cart hidden">
        <div class="msc-info">
            <span class="msc-label">Spolu s DPH:</span>
            <span id="msc-total" class="msc-price">0,00 €</span>
        </div>
        <button class="button msc-btn" onclick="document.getElementById('order-summary-section').scrollIntoView({behavior: 'smooth'})">
            Dokončiť <i class="fas fa-chevron-down"></i>
        </button>
    </div>

    <script src="{{ url_for('static', filename='js/b2c.js') }}"></script>
</body>
</html>